<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_email">
    <sys_script_email action="INSERT_OR_UPDATE">
        <name>Endpoint_Deletion_email_script</name>
        <new_lines_to_html>false</new_lines_to_html>
        <script><![CDATA[(function runMailScript(/* GlideRecord */ current, /* TemplatePrinter */ template,
          /* Optional EmailOutbound */ email, /* Optional GlideRecord */ email_action,
          /* Optional GlideRecord */ event) {
	
	try{
		
		CASLogger.debug("Inside EmailScript : Endpoint Email Notification for Delete Operation");
		
		var appUtil = new CASAppUtil();
		
		//get the Endpoint Active Status.
		var endpointStatus = "Deactive";
		var mid_name = "";
		
		//convert the dateTime to GMT datetime
		var newCreatedOn = appUtil.getGMTDateTime(current.sys_created_on, 'GMT');
		var newUpdatedOn = appUtil.getGMTDateTime(current.sys_updated_on, 'GMT');
		
		//get the current username
		var deletedBy = event.parm2;

		//get the Midserver Name..
		var midserver = new GlideRecordSecure(appUtil.configuration.table.midserver);
		midserver.addEncodedQuery('sys_id='+current.mid_server);
		midserver.query();
		if(midserver.next()){
			mid_name = midserver.name;
		}

		if (current.select_automation_service == "vRealiseAutomationCloud") {
		//printing the Email Template of vRA Cloud
			
			template.print(
			"<div style='height: inherit; width: 100%; padding: 4px; text-align: center; background-color: #ffffbf; margin: 10px 0px 20px 0px; font-family: arial; font-weight: 400; font-size: 19px;'><strong>Endpoint Details</strong></div><div style='margin: 10px 0px 10px 0px;font-family: arial; font-size: 14.5px;'><p>Hi "+ current.sys_created_by +",</p><p>The Endpoint has been Deleted with following details</p><br/></div><table style='font-family: arial; border-collapse: collapse; width: 100%;'><tbody><tr style='background-color: #dddddd;'><td style='border: 1px solid #dddddd; text-align: left; padding: 2px; font-size: 12px;'>Endpoint Type</td><td style='border: 1px solid #dddddd; text-align: left; padding: 2px; font-size: 12px;'><strong>" + current.getDisplayValue('select_automation_service') + "</strong></td></tr><tr style='background-color: #ffffff;'><td style='border: 1px solid #ffffff; text-align: left; padding: 2px; font-size: 12px;'>Endpoint Name</td><td style='border: 1px solid #ffffff; text-align: left; padding: 2px; font-size: 12px;'><strong>" + current.name + "</strong></td></tr><tr style='background-color: #dddddd;'><td style='border: 1px solid #dddddd; text-align: left; padding: 2px; font-size: 12px;'>Created By</td><td style='border: 1px solid #ffffff; text-align: left; padding: 2px; font-size: 12px;'><strong>" + current.sys_created_by + "</strong></td></tr><tr style='background-color: #ffffff;'><td style='border: 1px solid #ffffff; text-align: left; padding: 2px; font-size: 12px;'>Deleted By</td><td style='border: 1px solid #ffffff; text-align: left; padding: 2px; font-size: 12px;'><strong>" + deletedBy + "</strong></td></tr><tr style='background-color: #dddddd;'><td style='border: 1px solid #dddddd; text-align: left; padding: 2px; font-size: 12px;'>Created On</td><td style='border: 1px solid #ffffff; text-align: left; padding: 2px; font-size: 12px;'><strong>" + newCreatedOn + "</strong></td></tr><tr style='background-color: #ffffff;'><td style='border: 1px solid #ffffff; text-align: left; padding: 2px; font-size: 12px;'>Deleted On</td><td style='border: 1px solid #ffffff; text-align: left; padding: 2px; font-size: 12px;'><strong>" + newUpdatedOn + "</strong></td></tr></tbody></table>"
			);

		}else if(current.select_automation_service == "vrealizeAutomationService"){
		//printing the Email Template of vRA 
			
			template.print(
				"<div style='height: inherit; width: 100%; padding: 4px; text-align: center; background-color: #ffffbf; margin: 10px 0px 20px 0px; font-family: arial; font-weight: 400; font-size: 19px;'><strong>Endpoint Details</strong></div><div style='margin: 10px 0px 10px 0px;font-family: arial; font-size: 14.5px;'><p>Hi "+ current.sys_created_by +",</p><p>The Endpoint has been Deleted with following details</p><br/></div><table style='font-family: arial; border-collapse: collapse; width: 100%;'><tbody><tr style='background-color: #dddddd;'><td style='border: 1px solid #dddddd; text-align: left; padding: 2px; font-size: 12px;'>Endpoint Type</td><td style='border: 1px solid #dddddd; text-align: left; padding: 2px; font-size: 12px;'><strong>" + current.getDisplayValue('select_automation_service') + "</strong></td></tr><tr style='background-color: #ffffff;'><td style='border: 1px solid #ffffff; text-align: left; padding: 2px; font-size: 12px;'>Endpoint Name</td><td style='border: 1px solid #ffffff; text-align: left; padding: 2px; font-size: 12px;'><strong>" + current.name + "</strong></td></tr><tr style='background-color: #dddddd;'><td style='border: 1px solid #dddddd; text-align: left; padding: 2px; font-size: 12px;'>Host URL</td><td style='border: 1px solid #dddddd; text-align: left; padding: 2px; font-size: 12px;'><strong>" + current.hostname + "<br/></strong></td></tr><tr style='background-color: #ffffff;'><td style='border: 1px solid #ffffff; text-align: left; padding: 2px; font-size: 12px;'>Username</td><td style='border: 1px solid #ffffff; text-align: left; padding: 2px; font-size: 12px;'><strong>" + current.username + "</strong></td></tr><tr style='background-color: #dddddd;'><td style='border: 1px solid #dddddd; text-align: left; padding: 2px; font-size: 12px;'>Midserver</td><td style='border: 1px solid #dddddd; text-align: left; padding: 2px; font-size: 12px;'><strong>" + mid_name + "</strong></td></tr><tr style='background-color: #ffffff;'><td style='border: 1px solid #ffffff; text-align: left; padding: 2px; font-size: 12px;'>Created By</td><td style='border: 1px solid #ffffff; text-align: left; padding: 2px; font-size: 12px;'><strong>" + current.sys_created_by + "</strong></td></tr><tr style='background-color: #dddddd;'><td style='border: 1px solid #dddddd; text-align: left; padding: 2px; font-size: 12px;'>Deleted By</td><td style='border: 1px solid #dddddd; text-align: left; padding: 2px; font-size: 12px;'><strong>" + deletedBy + "</strong></td></tr><tr style='background-color: #ffffff;'><td style='border: 1px solid #ffffff; text-align: left; padding: 2px; font-size: 12px;'>Created On</td><td style='border: 1px solid #ffffff; text-align: left; padding: 2px; font-size: 12px;'><strong>" + newCreatedOn + "</strong></td></tr><tr style='background-color: #dddddd;'><td style='border: 1px solid #dddddd; text-align: left; padding: 2px; font-size: 12px;'>Deleted On</td><td style='border: 1px solid #dddddd; text-align: left; padding: 2px; font-size: 12px;'><strong>" + newUpdatedOn + "</strong></td></tr></tbody></table>"
			);
			
		}
		
	}catch(e){
		CASLogger.error("Exception caught inside EmailScript : Endpoint Delete Email Notification "+e);
	}

})(current, template, email, email_action, event);]]></script>
        <sys_class_name>sys_script_email</sys_class_name>
        <sys_created_by>prateek</sys_created_by>
        <sys_created_on>2020-02-04 11:10:54</sys_created_on>
        <sys_id>50414941dbb600105bf1fe1b68961997</sys_id>
        <sys_mod_count>55</sys_mod_count>
        <sys_name>Endpoint_Deletion_email_script</sys_name>
        <sys_package display_value="VMware vRealize Automation ITSM Application 8.3" source="x_vmw_cloudservice">0d6a0ec1db11bb407c83712ebf96194d</sys_package>
        <sys_policy/>
        <sys_scope display_value="VMware vRealize Automation ITSM Application 8.3">0d6a0ec1db11bb407c83712ebf96194d</sys_scope>
        <sys_update_name>sys_script_email_50414941dbb600105bf1fe1b68961997</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2020-05-18 15:03:25</sys_updated_on>
    </sys_script_email>
</record_update>
