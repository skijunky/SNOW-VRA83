<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($scope,$location) {
	/* widget controller */
	var c = this;
	for(var keys in c.data.res_arr){
		c.data.res_arr[keys].totalDisplayed= {deployments:2, dless:false, machines:2, mless:false, users:1, uless:false };
	}

	$scope.redirect = function(url) {
		$location.url(url);
	}
	$scope.$on("getPaginationDataEvent", function (evt, response) {
			c.data.res_arr = response.itemsArray;
		for(var keys in c.data.res_arr){
			c.data.res_arr[keys].totalDisplayed= {deployments:2, dless:false, machines:2, mless:false, users:1, uless:false };
		}
		$scope.totalRecords = response.totalRecords;
	});

	$scope.filterSearch = function(passedSearch) {
		var query = '';
		if (passedSearch != '') {
			query = 
				'nameLIKE' + passedSearch + '^NQ' +
				'descriptionLIKE' + passedSearch + '^NQ' +
				'usersLIKE' + passedSearch + '^NQ' +
				'groupsLIKE' + passedSearch + '^NQ' +
				'deploymentsLIKE' + passedSearch + '^NQ' +
				'machinesLIKE' + passedSearch ;

		} 
//alert(query);
		var passingObj={'query':query};
		$scope.$broadcast('setPaginationDataEvent', passingObj)
	}

	$scope.loadless= function(cat, id){
		for(var keys in c.data.res_arr){
			if(c.data.res_arr[keys].resourceId === id){
				if(cat === 'deployments'){
					c.data.res_arr[keys].totalDisplayed.deployments = 2;
					c.data.res_arr[keys].totalDisplayed.dless = false;
				}else if(cat === 'machines'){
					c.data.res_arr[keys].totalDisplayed.machines = 2;
					c.data.res_arr[keys].totalDisplayed.mless = false;
				}else if(cat === 'usersAndGroups'){
					c.data.res_arr[keys].totalDisplayed.users = 1;
					c.data.res_arr[keys].totalDisplayed.uless = false;
				}
			}
		}
	}
	$scope.loadmore= function(len, cat, id){
		for(var keys in c.data.res_arr){
			if(c.data.res_arr[keys].resourceId === id){
				if(cat === 'deployments'){
					c.data.res_arr[keys].totalDisplayed.deployments = len;
					c.data.res_arr[keys].totalDisplayed.dless = true;
				}else if(cat === 'machines'){
					c.data.res_arr[keys].totalDisplayed.machines = len;
					c.data.res_arr[keys].totalDisplayed.mless = true;
				}else if(cat === 'usersAndGroups'){
					c.data.res_arr[keys].totalDisplayed.users = len;
					c.data.res_arr[keys].totalDisplayed.uless = true;
				}
			}
		}
	}
	$scope.deleteResource=function(id){
		$('.action-modal, .action-modal-backdrop').show();
		c.data.res_id=id;	
	}

	$scope.confirmUnshare=function(){	
		c.data.action="delete";
		c.server.update().then(function(){
			$scope.$broadcast('setPaginationDataEvent', {showMyFilter : c.data.myFlag});
			c.data.action='';
			c.data.res_id='';
			for(var key in c.data.res_arr){
				c.data.res_arr[key].totalDisplayed= {deployments:2, dless:false, machines:2, mless:false, users:1, uless:false };
			}
		});

	}

}]]></client_script>
        <controller_as>c</controller_as>
        <css>
.header-tool-container {
  display: flex;
}
.cas-clr-col-6 &gt; h2 {
  margin-top: 0;
  line-height: 1.475rem;
}
.fullwidth{
  width:100%;
}


.empty-message-container {
  height: calc(100vh - 193.4px);
  display: flex;
  width:100%;
  align-items: center;
  justify-content: center;
  span {
    span {
      display: inline-flex;
      margin: auto;
      position: relative;
      left: 50%;
      transform: translateX(-50%);
    }
  }
}

.infinite-container{
  padding-top: 0;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
  height: calc(100vh - 216.39999px);
  overflow-y: auto;
  overflow-x: hidden;
}
.header-tool-container {
  display: flex;
}
.wdg-btn-link {
  padding: 0;
  margin: 0;
  max-width: 30px;
  min-width: 30px;
  fill: #0078b8;
  &amp;:hover  {
    fill: #004d8a;
  }
}
.cas-disabled {
  fill: #565656;
  cursor: not-allowed;
  opacity: .4;
  background-color: transparent;
  border-color: transparent;
  -webkit-box-shadow: none;
  box-shadow: none;
  &amp;:hover {
    fill: #565656;
  }
}
.wdg-badge-count {
  vertical-align: middle;
}

.cas-search {
  width: calc(100% - 260px);
}
.infinite-container {
  height: calc(100vh - 10rem);
  overflow-y: auto;
  overflow-x: hidden;
}
.col-lg-3, .col-md-4, col-12 {
  padding: 0px 12px;
}
span[shape="search"] {
  margin: 3px;
}
span[shape="user"],
span[shape="users"],
span[shape="vm"],
span[shape="vmw-app"] {
  margin-right: 5px;
  vertical-align: top;
}
/*span[shape="vmw-app"] {
margin-right: 5px;
vertical-align: top;
}
span[shape="user"] {
margin-right: 5px;
vertical-align: top;
}*/
span[shape="success-standard"], span[shape="close-circle"], span[shape="info-standard"] {
  vertical-align: text-bottom;
}

.wdg-desc {
  display: inline-block;
  width: calc(100% - 45px);
  a {
    font-size: 16px;
  }
  div {
    font-size: 12px;
  }
}

.wdg-desc.wdg-empty {
  color: #9a9a9a !important;
}


.wdg-value {
  font-weight: 500;
}
input, textarea, select, .dropdown {
  width: 100%;
}

.cas-dropdown .cas-dropdown-toggle.cas-btn {
  padding-right: 0.5rem;
}

.cas-dropdown-item {
  padding: .125rem 1rem;
}
.cas-dropdown-menu{
  visibility: visible;
}

.wdg-action {
  position: absolute;
  right: 0;
  top: 6px;
}

.margin-top-05 {
  margin-top: .5rem;
}

/* CSS classes for rsGrid*/

.cas-clr-checkbox-wrapper input[type=checkbox], .cas-clr-radio-wrapper input[type=radio] {
  position: absolute;
  opacity: 0;
  top: 5px;
  left: 0;
  height: .66667rem;
  width: .66667rem;
}

.cas-clr-checkbox-wrapper
.cas-clr-control-label {
  font-weight: 400;
  display: block;
}

.cas-clr-checkbox-wrapper label, 
.cas-clr-radio-wrapper label {
  position: relative;
  margin-bottom: 0;
  display: inline-block;
  color: #000;
  min-height: 1rem;
  padding-left: .916667rem;
  margin-top: 0;
  cursor: pointer;
  line-height: 1rem;
}

.cas-clr-control-label {
  display: block;
  color: #444;
  font-size: .541667rem;
  font-weight: 600;
  line-height: .75rem;
}

cas-clr-control-message {
  display: block;
  color: #444;
  line-height: .75rem;
  width: unset;
}

.cas-clr-checkbox-wrapper input[type=checkbox]+label::before {
  position: absolute;
  top: .1666665rem;
  left: 0;
  content: "";
  display: inline-block;
  height: .666667rem;
  width: .666667rem;
  border: 1px solid #9a9a9a;
  border-radius: .125rem;
}

.cas-table thead th:first-child {
  border-radius: calc(.125rem - 1px) 0 0 0;
}

th.left {
  text-align: left;
}
.cas-table tbody tr:first-child td {
  border-top: 0 none;
}

.cas-table td.left, .table th.left {
  text-align: left;
}
.cas-table td {
  font-size: .541667rem;
  border-top: 1px solid #eee;
  vertical-align: top;
}
.cas-table td, .table th {
  line-height: .5833334rem;
  padding: .4583333333rem .5rem;
  text-align: center;
}
.cas-checkbox-container {
  padding: 6px 0 6px 14px !important;
}

.cas-open{
  display: none;
}

.cas-card-text {
  font-size: .583333rem;
}
.cas-card-text .value {
  font-weight: 500;
}
.cas-card-text .value-desc {
  line-height: .75rem;
  font-size: .5rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.cas-card-block &gt; button {
  position: absolute;
  top: 6px;
  right: 6px;
}
.cas-card .cas-card-block .cas-card-text {
  margin-bottom: 0;
}
.desc a {
  font-size: 16px;
}
.desc div {
  font-size: 12px;
}
a.link-visited:link, a:visited {
  color: #5659b9;
  text-decoration: none;
}

a.link-normal:link, a:link {
  color: #0079b8;
  text-decoration: none;
}

.cas-clr-col-md-5, .cas-clr-col-md-6 {
  -webkit-box-flex: 0;
  -ms-flex: 0 0 41.6666666667%;
  flex: 0 0 41.6666666667%;
  max-width: 41.6666666667%;
}
.cas-clr-col-md-2 {
  -ms-flex: 0 0 16.6666666667%;
  flex: 0 0 16.6666666667%;
  max-width: 16.6666666667%;
}

.cas-btn-primary .cas-btn, .cas-btn.cas-btn-primary {
  border-color: #007cbb;
  background-color: #007cbb;
  color: #fff;
}
.padding5{
  padding-left: .28rem;
}
.cas-card{
  min-height:110px;
} 
.wdg-load-more-container {
  display: flex;
  justify-content: center;
}

.wdg-load-more-wrapper {
  height: auto;
}
.word-alignment{
    max-width: 90%;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.cas-dropdown {
  display: flex;
  justify-content: flex-end;
}
.wdg-dropdown {
  background: transparent;
  border: none;
  display: flex;
  align-items: center;
  padding: 0px;
  margin-bottom: -3px;
}
.dropdown-menu {
  padding: .5rem 0;
  background: #fff;
  border: 1px solid #ccc;
      margin-right: 6px;
  border-radius: .125rem;
  box-shadow: 0 1px 0.125rem rgba(115,115,115,.25);
}
.cas-dropdown-item {
  a {
    color: #575757;
  }
  padding: .125rem 1rem;
  &amp;:hover {
    background-color: #ededed;
    color: #575757;
    text-decoration: none;
  }
}
.clearSearch{
  position:relative;
  right:15px;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id/>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>CAS_sharedResourcesCard</name>
        <option_schema>[{"name":"page_window_size","section":"other","default_value":"20","label":"Page window size","type":"string"}]</option_schema>
        <public>false</public>
        <roles>x_vmw_cloudservice.vra_catalog_admin,x_vmw_cloudservice.vra_end_user</roles>
        <script><![CDATA[(function() {
	/* populate the 'data' object */
	/* e.g., data.table = $sp.getValue('table'); */
	var appUtil=new CASAppUtil();
	var daoUtil=new CASDaoUtil();
	data.filterText='';
	var urlOrder = $sp.getParameter('order') || ((urlTable == appUtil.configuration.table.approvals)? 10 : 6);
	var urlPage = $sp.getParameter('id') || '';
	var urlTable = $sp.getParameter('table') || appUtil.configuration.table.requests;

	var urlMyFlag = ($sp.getParameter('myFlag') != '' && $sp.getParameter('myFlag') != null && $sp.getParameter('myFlag')) ?  $sp.getParameter('myFlag') : true + '';
data.myFlag = urlMyFlag;
	if(input){
		data.action=input.action;
		data.res_arr=input.res_arr;
		if(data.action=='delete'){
			data.res_id=input.res_id;
			daoUtil.deleteSharedResource(data.res_id);
			
		}
	}
	var catalogAdmin = gs.getProperty(appUtil.configuration.properties.vraCatalogAdmin);
	data.showFilter = (gs.getUser().hasRole('admin') || gs.getUser().hasRole(catalogAdmin));


//	data.res_arr=daoUtil.fetchSharedResources({});
	var paginationOptionSchema = {
		windowSize: (options.page_window_size) ? options.page_window_size : 20,
		table: appUtil.configuration.table.shared_resources,
		method: 'fetchSharedResources',
		showMyFilter: urlMyFlag,
		query: '',
		infiniteScroll: true
	}
	data.widgetScript = $sp.getWidget('cas_pagination', paginationOptionSchema);

	data.link = {		
		showMyFilterTrue: '/'+gs.getProperty(appUtil.configuration.properties.portalPrefix)+'?id=' + urlPage + '&table=' + urlTable + '&order=' + urlOrder + '&myFlag=true',
		showMyFilterFalse: '/'+gs.getProperty(appUtil.configuration.properties.portalPrefix)+'?id=' + urlPage + '&table=' + urlTable + '&order=' + urlOrder + '&myFlag=false',
		list: '/'+gs.getProperty(appUtil.configuration.properties.portalPrefix)+'?id='+ appUtil.configuration.page.sharedResourcesList+'&order=' + urlOrder + '&myFlag=' + urlMyFlag,		
		card: '/'+gs.getProperty(appUtil.configuration.properties.portalPrefix)+'?id=' + appUtil.configuration.page.sharedResources + '&order=' + urlOrder + '&myFlag=' + urlMyFlag,		
		baseUrl: '/'+gs.getProperty(appUtil.configuration.properties.portalPrefix)+'?id='+appUtil.configuration.page.sharedResourceForm+'&order=' + urlOrder + '&myFlag=' + urlMyFlag + '&sysId='				
	}
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>sagar</sys_created_by>
        <sys_created_on>2019-08-29 07:31:51</sys_created_on>
        <sys_id>6c8a55f5db233300ff7c294648961956</sys_id>
        <sys_mod_count>342</sys_mod_count>
        <sys_name>CAS_sharedResourcesCard</sys_name>
        <sys_package display_value="VMware vRealize Automation ITSM Application 8.3" source="x_vmw_cloudservice">0d6a0ec1db11bb407c83712ebf96194d</sys_package>
        <sys_policy/>
        <sys_scope display_value="VMware vRealize Automation ITSM Application 8.3">0d6a0ec1db11bb407c83712ebf96194d</sys_scope>
        <sys_update_name>sp_widget_6c8a55f5db233300ff7c294648961956</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-12-23 10:12:21</sys_updated_on>
        <template><![CDATA[<div class="cas-content-area">
  <div class="cas-clr-row">
    <div class="cas-clr-col-6">
      <h2>
        <span id="activityHeader">Shared Resources</span>
        <span class="cas-label cas-label-info wdg-badge-count">{{c.data.res_arr.length}}
          of {{totalRecords}} {{(totalRecords > 0) ? 'Items' : 'Item'}}</span>
        <span id="filter" class="cas-label cas-label-light-blue wdg-badge-count" onclick="selectAll(this)"
              style="display: none;">
          <span></span>
          <cas-clr-icons icon-name="close"> </cas-clr-icons>
        </span>
      </h2>
    </div>
    <div class="cas-clr-col-6 header-tool-container" style="display:flex">
      <div class="dropdown cas-dropdown">
        <button ng-if="c.data.showFilter" class="dropdown-toggle cas-dropdown-toggle cas-btn cas-btn-link" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          View My Activities
          <cas-clr-icon shape="angle" dir="down" color="#0077b7" size="12" role="none"></cas-clr-icon>
        </button>
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
          <div class="cas-dropdown-item" ng-click="redirect(c.data.link.showMyFilterTrue)">
            View My Activities
          </div>
          <div class="cas-dropdown-item" ng-click="redirect(c.data.link.showMyFilterFalse)">
            View All Activities
          </div>
        </div>
      </div>

      <cas-clr-icon size="16" shape="search" color="#565656"></cas-clr-icon>
      <input type="text" placeholder="Search" 
             class="wdg-search cas-clr-input"
             ng-model="c.data.filterText" 
             ng-model-options="{ debounce: 500 }" 
             ng-change="filterSearch(c.data.filterText)" />
		<span class="clearSearch" ng-show="c.data.filterText!=''" ng-click="filterSearch('');c.data.filterText='';"><i class="fa fa-times" aria-hidden="true"></i></span>
    
      <a class="wdg-btn-link cas-toggle-view padding5" href="{{c.data.link.list}}">
        <cas-clr-icon shape="view-list" size="20" role="none"></cas-clr-icon>
      </a>
      <a class="wdg-btn-link cas-disabled padding5" href="{{c.data.link.card}}">
        <cas-clr-icon shape="view-cards" size="20" role="none"></cas-clr-icon>
      </a>

    </div>
  </div>

  <div class="cas-clr-row data">
    <div class="cas-clr-col-12 margin-top-05">
      <div class="cas-btn-group cas-btn-outline-primary cas-btn-sm">
        <a class="cas-btn" href="{{c.data.link.baseUrl}}">
          <cas-clr-icon shape="plus" size="10" color="#0079b8"></cas-clr-icon>
          New Share
        </a>
      </div>
    </div>
    <div class="cas-clr-col-12 infinite-container" ng-show="c.data.res_arr.length!=0">

      <div class="cas-card" ng-repeat="resource in c.data.res_arr">
        <div class="cas-card-block">
          <div class="cas-card-text cas-clr-row">
            <div class="cas-clr-col-3">
              <div class="desc">
                <a href="{{c.data.link.baseUrl}}{{resource.resourceId}}">{{resource.name}}</a>
                <div class="desc empty">
                  {{resource.description}}  
                </div>
              </div>
            </div>
            <div class="cas-clr-col-3">
              <span class="value">{{resource.deployment_name_arr.length}}</span> Deployments
              <div class="value-desc" ng-repeat="item in resource.deployment_name_arr  track by $index">
                <div  ng-if="$index < resource.totalDisplayed.deployments" class="word-alignment">
                  <cas-clr-icon shape="vmw-app" size="16" color="#565656" ></cas-clr-icon >{{item}}
                </div>
              </div>
              <a href="javascript:" ng-if="resource.deployment_name_arr.length > 2 && resource.totalDisplayed.dless == false"
                 ng-click="loadmore(resource.deployment_name_arr.length,'deployments',resource.resourceId)">...more</a>
              <a href="javascript:" ng-if="resource.deployment_name_arr.length > 2 && resource.totalDisplayed.dless  == true"
                 ng-click="loadless('deployments',resource.resourceId)">...less</a>
            </div>
            <div class="cas-clr-col-3">
              <span class="value">{{resource.machine_name_arr.length}}</span> Resources
              <div class="value-desc"  ng-repeat="item in resource.machine_name_arr track by $index">
                <div ng-if="$index < resource.totalDisplayed.machines" class="word-alignment">
                  <cas-clr-icon shape="vm" size="16" color="#565656"></cas-clr-icon>{{item}}
                </div>
              </div>
              <a href="javascript:"  ng-if="resource.machine_name_arr.length > 2 && resource.totalDisplayed.mless == false"
                 ng-click="loadmore(resource.machine_name_arr.length,'machines',resource.resourceId)">...more</a>
              <a href="javascript:" ng-if="resource.machine_name_arr.length > 2 && resource.totalDisplayed.mless  == true"
                 ng-click="loadless('machines',resource.resourceId)">...less</a>
            </div>
            <div class="cas-clr-col-3">
              <span class="value">{{resource.groups_name_arr.length}}</span> Groups, <span class="value">{{resource.users_name_arr.length}}</span> Users
              <div class="value-desc" ng-repeat="item in resource.users_name_arr track by $index">
                <div ng-if="$index < resource.totalDisplayed.users" class="word-alignment">
                  <cas-clr-icon shape="user" size="16" color="#565656"></cas-clr-icon> {{item}}
                </div>
              </div>
              <div class="value-desc" ng-repeat="item in resource.groups_name_arr track by $index">
                <div ng-if="$index < resource.totalDisplayed.users" class="word-alignment">
                  <cas-clr-icon shape="users" size="16" color="#565656"></cas-clr-icon> {{item}}
                </div>
              </div>
              <a href="javascript:" ng-if="(resource.users_name_arr.length+resource.groups_name_arr.length) > 2 && resource.totalDisplayed.uless == false" 
                 ng-click="loadmore(resource.users_name_arr.length+resource.groups_name_arr.length,'usersAndGroups',resource.resourceId)">...more</a>
              <a href="javascript:" ng-if="(resource.users_name_arr.length+resource.groups_name_arr.length) > 2 && resource.totalDisplayed.uless == true"
                 ng-click="loadless('usersAndGroups',resource.resourceId)">...less</a>
            </div>
          </div>
          <button class="cas-btn cas-btn-link" ng-click="deleteResource(resource.resourceId)">unshare</button>
        </div>
      </div>
      <div class="cas-clr-row">
        <div class="cas-clr-col-12 wdg-load-more-container">
          <div class="cas-btn cas-btn-link wdg-load-more-wrapper">
            <sp-widget widget="c.data.widgetScript"></sp-widget>
          </div>
        </div>
      </div>
    </div>
    <div class="empty-message-container"  ng-if="c.data.res_arr.length==0">
      <span><cas-clr-icon shape="sad-face" color="#717171" size="30"></cas-clr-icon>
        <p>No Record Found</p>
      </span>
    </div>

  </div>

  <!-----------------modal------------------------------->
  <div class="cas-modal action-modal" style="display: none">
    <div class="cas-modal-dialog" role="dialog" aria-hidden="true">
      <div class="cas-modal-content">
        <div class="cas-modal-header">
          <button aria-label="Close" class="cas-close" type="button" onclick="$('.cas-modal, .cas-modal-backdrop').hide()">
            <cas-clr-icon aria-hidden="true" shape="close" color="#565656" size="25" role="none"></cas-clr-icon>
          </button>
          <h3 class="cas-modal-title">Unshare</h3>
        </div>
        <div class="cas-modal-body">
          <div>
            <form class="cas-clr-form cas-clr-form-horizontal">
              <div class="cas-clr-form-control cas-no-margin">
                <label class="cas-clr-control-message">Are you sure to unshare the resource ?</label>
              </div>
            </form>
          </div>
        </div>
        <div class="cas-modal-footer">
          <button class="cas-btn cas-btn-outline" type="button" onclick="$('.cas-modal, .cas-modal-backdrop').hide()">Cancel</button>
          <button class="cas-btn cas-btn-primary" type="button" ng-click="confirmUnshare()" onclick="$('.cas-modal, .cas-modal-backdrop').hide()">Submit</button>
        </div>
      </div>
    </div>
  </div>
  <div class="cas-modal-backdrop action-modal-backdrop" aria-hidden="true" style="display: none;"></div>
  <!-----------------modal ends here----------------->
</div>
<script>
  function SRtoggleAction () {
    var el = document.getElementById('sr-activities-dropdown');
    el.classList.toggle("cas-open");
  }
</script>]]></template>
    </sp_widget>
</record_update>
