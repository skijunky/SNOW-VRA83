<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller=function($scope) {
  /* widget controller */
  var c = this;

  
  
	
};]]></client_script>
        <controller_as>c</controller_as>
        <css>.cas_sp_button_container{&#13;
  margin : 0;&#13;
  padding : 0;&#13;
}&#13;
&#13;
.cas_sp_navigate_btn{&#13;
  color: #ffffff;&#13;
  background-color: #1F8476;&#13;
  border-color: #1a6f64;&#13;
  width : 250px;&#13;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>cas_sp_returntodeployment</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>CAS_SP_returnToDeployment</name>
        <option_schema/>
        <public>false</public>
        <roles>x_vmw_cloudservice.vra_catalog_admin,x_vmw_cloudservice.vra_end_user</roles>
        <script><![CDATA[(function() {
    /* populate the 'data' object */
    /* e.g., data.table = $sp.getValue('table'); */
    try {
        CASLogger.debug('Inside CAS_SP_returnToDeployment widget');
        var daoUtil = new CASDaoUtil();
        var appUtil = new CASAppUtil();

        if (!input) {

            data.pageId = $sp.getParameter('id') || null;
            data.table = $sp.getParameter('table') || null;
            data.requestSysId = null;
            data.RITMSysId = null;
            data.request_number = '';
            data.deployment_sys_id = '';
            data.resource_sys_id = '';
            data.buttonVisibile = false;

            if (data.table == 'sc_request') {
				//looking for Deployment & Resource SysId on the Request page.
                data.requestSysId = $sp.getParameter('sys_id') || null;
				var RITMGr = '';

                if (data.requestSysId) {
                    var gr = new GlideRecordSecure('sc_request');
                    gr.addEncodedQuery('sys_id=' + data.requestSysId);
                    gr.query();
                    if (gr.next()) {
                        data.request_number = gr.number.getDisplayValue();

                        RITMGr = new GlideRecordSecure(appUtil.configuration.table.requests);
                        RITMGr.addEncodedQuery('requestSTARTSWITH' + data.request_number);
                        RITMGr.query();
                        if (RITMGr.next()) {
                            if (RITMGr.cat_item.sys_class_name.toString() == appUtil.configuration.table.catalogItem && RITMGr.cat_item.cas_uid.toString() == '') {
                                data.buttonVisibile = true;
                            }

                            data.deployment_sys_id = (RITMGr.variables.deployment) ? RITMGr.variables.deployment.toString() : '';
                            data.resource_sys_id = (RITMGr.variables.resource) ? RITMGr.variables.resource.toString() : '';
                        }
                    }

                }
            } else if (data.table == 'sc_req_item') {
				//looking for Deployment & Resource SysId on the RITM page.
                data.RITMSysId = $sp.getParameter('sys_id') || null;

                if (data.RITMSysId) {
                    RITMGr = new GlideRecordSecure(appUtil.configuration.table.requests);
                    RITMGr.addEncodedQuery('sys_id=' + data.RITMSysId);
                    RITMGr.query();
                    if (RITMGr.next()) {
                        if (RITMGr.cat_item.sys_class_name.toString() == appUtil.configuration.table.catalogItem && RITMGr.cat_item.cas_uid.toString() == '') {
                            data.buttonVisibile = true;
                        }
                        data.deployment_sys_id = (RITMGr.variables.deployment) ? RITMGr.variables.deployment.toString() : '';
                        data.resource_sys_id = (RITMGr.variables.resource) ? RITMGr.variables.resource.toString() : '';
                    }
                }
            }

			
//             if (data.resource_sys_id) {
//                 data.previousDeploymentLink = '/' + gs.getProperty(appUtil.configuration.properties.ServicePortalPrefix) + '?id=' + appUtil.configuration.page.casSPDeploymentDetailsPage + '&sysId=' + data.deployment_sys_id + '&macSysId=' + data.resource_sys_id;
//             } else {
			
			//asinging the URL to the link
                data.previousDeploymentLink = '/' + gs.getProperty(appUtil.configuration.properties.ServicePortalPrefix) + '?id=' + appUtil.configuration.page.casSPDeploymentDetailsPage + '&sysId=' + data.deployment_sys_id;
//             }
        }
    } catch (e) {
        CASLogger.error('Exception caught inside CAS_SP_returnToDeployment widget: ' + e);
    }

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2020-12-22 06:35:56</sys_created_on>
        <sys_id>5342d2ac1b11201029604196bc4bcb43</sys_id>
        <sys_mod_count>58</sys_mod_count>
        <sys_name>CAS_SP_returnToDeployment</sys_name>
        <sys_package display_value="VMware vRealize Automation ITSM Application 8.3" source="x_vmw_cloudservice">0d6a0ec1db11bb407c83712ebf96194d</sys_package>
        <sys_policy/>
        <sys_scope display_value="VMware vRealize Automation ITSM Application 8.3">0d6a0ec1db11bb407c83712ebf96194d</sys_scope>
        <sys_update_name>sp_widget_5342d2ac1b11201029604196bc4bcb43</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2021-02-18 09:34:37</sys_updated_on>
        <template><![CDATA[<div ng-if="c.data.buttonVisibile">
  <div class="cas_sp_button_container">
  	<a class="" href="{{c.data.previousDeploymentLink}}">
      View & Modify Resources
    </a>
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
